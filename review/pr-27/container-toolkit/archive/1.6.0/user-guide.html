<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide &mdash; NVIDIA Cloud Native Technologies  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/nvidia.ico"/>
    <link rel="canonical" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/archive/1.6.0/user-guide.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/js/google-analytics/google-analytics-tracker.js"></script>
        <script src="../../../_static/js/google-analytics/google-analytics-write.js"></script>
        <script src="//assets.adobedtm.com/b92787824f2e0e9b68dc2e993f9bd995339fe417/satelliteLib-7ba51e58dc61bcb0e9311aadd02a0108ab24cc6c.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Release Notes" href="release-notes.html" />
    <link rel="prev" title="Installation Guide" href="install-guide.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 
            <a href="../../../contents.html">
            <img src="../../../_static/NVLogo_H_B&W.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    .wy-nav-content {
      max-width: 1000px;
    }
  </style>
  
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">NVIDIA Container Toolkit:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arch-overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install-guide.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../archive.html">Archive</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id1">1.12.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id2">1.12.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id3">1.11.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id4">1.10.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id5">1.9.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id6">1.8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id7">1.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../archive.html#id8">1.7.0</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../archive.html#id9">1.6.0</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NVIDIA GPU Operator:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/platform-support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/gpu-driver-upgrades.html">GPU Driver Upgrades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/install-gpu-operator-vgpu.html">NVIDIA vGPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/install-gpu-operator-nvaie.html">NVIDIA AI Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/openshift/contents.html">GPU Operator on OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/gpu-operator-mig.html">GPU Operator with MIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/gpu-sharing.html">Time-Slicing GPUs in Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/gpu-operator-rdma.html">GPUDirect RDMA and GPUDirect Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/gpu-operator-kubevirt.html">GPU Operator with KubeVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/appendix.html">Advanced Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-operator/archive.html">Archive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kubernetes with GPUs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../kubernetes/install-k8s.html">Install Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kubernetes/mig-k8s.html">MIG Support in Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kubernetes/anthos-guide.html">NVIDIA GPUs with Google Cloud’s Anthos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NVIDIA GPUs and Red Hat Device Edge</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../edge/nvidia-gpu-with-device-edge.html">Accelerating workloads with NVIDIA GPUs with Red Hat Device Edge</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GPU Telemetry:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-telemetry/dcgm-exporter.html">DCGM-Exporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu-telemetry/dcgm-exporter.html#integrating-gpu-telemetry-into-kubernetes">Integrating GPU Telemetry into Kubernetes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multi-Instance GPU:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../mig/mig.html">Multi-Instance GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mig/mig-k8s.html">MIG Support in Kubernetes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Driver Containers:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-containers/overview.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Playground:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../playground/dind.html">Docker-in-Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../playground/x-arch.html">Running Cross-Architecture Containers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../contents.html">NVIDIA Cloud Native Technologies</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../contents.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../archive.html">Archive</a> &raquo;</li>
      <li>User Guide</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide">
<span id="user-guide-1-6-0"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this heading"></a></h1>
<p>The architecture of the NVIDIA Container Toolkit allows for different container engines
in the ecosystem - <a class="reference external" href="https://docs.docker.com/get-started/overview/">Docker</a>, <a class="reference external" href="https://linuxcontainers.org">LXC</a>,
<a class="reference external" href="http://podman.io/">Podman</a> to be supported easily.</p>
<section id="docker-1-6-0">
<span id="id1"></span><h2>Docker<a class="headerlink" href="#docker-1-6-0" title="Permalink to this heading"></a></h2>
<p>The NVIDIA Container Toolkit provides different options for enumerating GPUs and the capabilities that are supported
for CUDA containers. This user guide demonstrates the following features of the NVIDIA Container Toolkit:</p>
<ul class="simple">
<li><p>Registering the NVIDIA runtime as a custom runtime to Docker</p></li>
<li><p>Using environment variables to enable the following:</p>
<ul>
<li><p>Enumerating GPUs and controlling which GPUs are visible to the container</p></li>
<li><p>Controlling which features of the driver are visible to the container using <cite>capabilities</cite></p></li>
<li><p>Controlling the behavior of the runtime using constraints</p></li>
</ul>
</li>
</ul>
<section id="adding-the-nvidia-runtime">
<h3>Adding the NVIDIA Runtime<a class="headerlink" href="#adding-the-nvidia-runtime" title="Permalink to this heading"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not follow this section if you installed the <code class="docutils literal notranslate"><span class="pre">nvidia-docker2</span></code> package, it already registers the runtime.</p>
</div>
<p>To register the <code class="docutils literal notranslate"><span class="pre">nvidia</span></code> runtime, use the method below that is best suited to your environment.
You might need to merge the new argument with your existing configuration. Three options are available:</p>
<section id="systemd-drop-in-file">
<h4>Systemd drop-in file<a class="headerlink" href="#systemd-drop-in-file" title="Permalink to this heading"></a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/systemd/system/docker.service.d
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/systemd/system/docker.service.d/override.conf<span class="w"> </span>&lt;&lt;EOF
<span class="go">[Service]</span>
<span class="go">ExecStart=</span>
<span class="go">ExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime</span>
<span class="go">EOF</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</pre></div>
</div>
</section>
<section id="daemon-configuration-file">
<h4>Daemon configuration file<a class="headerlink" href="#daemon-configuration-file" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">nvidia</span></code> runtime can also be registered with Docker using the <code class="docutils literal notranslate"><span class="pre">daemon.json</span></code> configuration file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/docker/daemon.json<span class="w"> </span>&lt;&lt;EOF
<span class="go">{</span>
<span class="go">    &quot;runtimes&quot;: {</span>
<span class="go">        &quot;nvidia&quot;: {</span>
<span class="go">            &quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,</span>
<span class="go">            &quot;runtimeArgs&quot;: []</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}</span>
<span class="go">EOF</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo pkill -SIGHUP dockerd</span>
</pre></div>
</div>
<p>You can optionally reconfigure the default runtime by adding the following to <code class="docutils literal notranslate"><span class="pre">/etc/docker/daemon.json</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&quot;default-runtime&quot;: &quot;nvidia&quot;</span>
</pre></div>
</div>
</section>
<section id="command-line">
<h4>Command Line<a class="headerlink" href="#command-line" title="Permalink to this heading"></a></h4>
<p>Use <code class="docutils literal notranslate"><span class="pre">dockerd</span></code> to add the <code class="docutils literal notranslate"><span class="pre">nvidia</span></code> runtime:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sudo<span class="w"> </span>dockerd<span class="w"> </span>--add-runtime<span class="o">=</span><span class="nv">nvidia</span><span class="o">=</span>/usr/bin/nvidia-container-runtime<span class="w"> </span><span class="o">[</span>...<span class="o">]</span>
</pre></div>
</div>
</section>
</section>
<section id="environment-variables-oci-spec">
<h3>Environment variables (OCI spec)<a class="headerlink" href="#environment-variables-oci-spec" title="Permalink to this heading"></a></h3>
<p>Users can control the behavior of the NVIDIA container runtime using environment variables - especially for
enumerating the GPUs and the capabilities of the driver.
Each environment variable maps to an command-line argument for <code class="docutils literal notranslate"><span class="pre">nvidia-container-cli</span></code> from <a class="reference external" href="https://github.com/NVIDIA/libnvidia-container">libnvidia-container</a>.
These variables are already set in the NVIDIA provided base <a class="reference external" href="https://ngc.nvidia.com/catalog/containers/nvidia:cuda">CUDA images</a>.</p>
<section id="gpu-enumeration">
<h4>GPU Enumeration<a class="headerlink" href="#gpu-enumeration" title="Permalink to this heading"></a></h4>
<p>GPUs can be specified to the Docker CLI using either the <code class="docutils literal notranslate"><span class="pre">--gpus</span></code> option starting with Docker <code class="docutils literal notranslate"><span class="pre">19.03</span></code> or using the environment variable
<code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code>. This variable controls which GPUs will be made accessible inside the container.</p>
<p>The possible values of the <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code> variable are:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Possible values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0,1,2,</span></code> or <code class="docutils literal notranslate"><span class="pre">GPU-fef8089b</span></code></p></td>
<td><p>a comma-separated list of GPU UUID(s) or index(es).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">all</span></code></p></td>
<td><p>all GPUs will be accessible, this is the default value in base CUDA container images.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>no GPU will be accessible, but driver capabilities will be enabled.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">void</span></code> or <cite>empty</cite> or <cite>unset</cite></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nvidia-container-runtime</span></code> will have the same behavior as <code class="docutils literal notranslate"><span class="pre">runc</span></code> (i.e. neither GPUs nor capabilities are exposed)</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the <code class="docutils literal notranslate"><span class="pre">--gpus</span></code> option to specify the GPUs, the <code class="docutils literal notranslate"><span class="pre">device</span></code> parameter should be used. This is shown in the examples below.
The format of the <code class="docutils literal notranslate"><span class="pre">device</span></code> parameter should be encapsulated within single quotes, followed by double quotes for the devices you
want enumerated to the container. For example: <code class="docutils literal notranslate"><span class="pre">'&quot;device=2,3&quot;'</span></code> will enumerate GPUs 2 and 3 to the container.</p>
<p>When using the NVIDIA_VISIBLE_DEVICES variable, you may need to set <code class="docutils literal notranslate"><span class="pre">--runtime</span></code> to <code class="docutils literal notranslate"><span class="pre">nvidia</span></code> unless already set as default.</p>
</div>
<p>Some examples of the usage are shown below:</p>
<ol class="arabic">
<li><p>Starting a GPU enabled CUDA container; using <code class="docutils literal notranslate"><span class="pre">--gpus</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--gpus<span class="w"> </span>all<span class="w"> </span>nvidia/cuda<span class="w"> </span>nvidia-smi
</pre></div>
</div>
</li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code> and specify the nvidia runtime</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--runtime<span class="o">=</span>nvidia<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">NVIDIA_VISIBLE_DEVICES</span><span class="o">=</span>all<span class="w"> </span>nvidia/cuda<span class="w"> </span>nvidia-smi
</pre></div>
</div>
</li>
<li><p>Start a GPU enabled container on two GPUs</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--gpus<span class="w"> </span><span class="m">2</span><span class="w"> </span>nvidia/cuda<span class="w"> </span>nvidia-smi
</pre></div>
</div>
</li>
<li><p>Starting a GPU enabled container on specific GPUs</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--gpus<span class="w"> </span><span class="s1">&#39;&quot;device=1,2&quot;&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nvidia/cuda<span class="w"> </span>nvidia-smi<span class="w"> </span>--query-gpu<span class="o">=</span>uuid<span class="w"> </span>--format-csv
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uuid</span>
<span class="go">GPU-ad2367dd-a40e-6b86-6fc3-c44a2cc92c7e</span>
<span class="go">GPU-16a23983-e73e-0945-2095-cdeb50696982</span>
</pre></div>
</div>
</li>
<li><p>Alternatively, you can also use <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--runtime<span class="o">=</span>nvidia<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">NVIDIA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">1</span>,2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nvidia/cuda<span class="w"> </span>nvidia-smi<span class="w"> </span>--query-gpu<span class="o">=</span>uuid<span class="w"> </span>--format<span class="o">=</span>csv
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uuid</span>
<span class="go">GPU-ad2367dd-a40e-6b86-6fc3-c44a2cc92c7e</span>
<span class="go">GPU-16a23983-e73e-0945-2095-cdeb50696982</span>
</pre></div>
</div>
</li>
<li><p>Query the GPU UUID using <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code> and then specify that to the container</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nvidia-smi<span class="w"> </span>-i<span class="w"> </span><span class="m">3</span><span class="w"> </span>--query-gpu<span class="o">=</span>uuid<span class="w"> </span>--format<span class="o">=</span>csv
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uuid</span>
<span class="go">GPU-18a3e86f-4c0e-cd9f-59c3-55488c4b0c24</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--gpus<span class="w"> </span><span class="nv">device</span><span class="o">=</span>GPU-18a3e86f-4c0e-cd9f-59c3-55488c4b0c24<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>nvidia/cuda<span class="w"> </span>nvidia-smi
</pre></div>
</div>
</li>
</ol>
</section>
<section id="driver-capabilities">
<h4>Driver Capabilities<a class="headerlink" href="#driver-capabilities" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">NVIDIA_DRIVER_CAPABILITIES</span></code> controls which driver libraries/binaries will be mounted inside the container.</p>
<p>The possible values of the <code class="docutils literal notranslate"><span class="pre">NVIDIA_DRIVER_CAPABILITIES</span></code> variable are:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Possible values</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">compute,video</span></code> or <code class="docutils literal notranslate"><span class="pre">graphics,utility</span></code></p></td>
<td><p>a comma-separated list of driver features the container needs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">all</span></code></p></td>
<td><p>enable all available driver capabilities.</p></td>
</tr>
<tr class="row-even"><td><p><cite>empty</cite> or <cite>unset</cite></p></td>
<td><p>use default driver capability: <code class="docutils literal notranslate"><span class="pre">utility</span></code>, <code class="docutils literal notranslate"><span class="pre">compute</span></code></p></td>
</tr>
</tbody>
</table>
<p>The supported driver capabilities are provided below:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Driver Capability</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">compute</span></code></p></td>
<td><p>required for CUDA and OpenCL applications.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">compat32</span></code></p></td>
<td><p>required for running 32-bit applications.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">graphics</span></code></p></td>
<td><p>required for running OpenGL and Vulkan applications.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">utility</span></code></p></td>
<td><p>required for using <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code> and NVML.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">video</span></code></p></td>
<td><p>required for using the Video Codec SDK.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">display</span></code></p></td>
<td><p>required for leveraging X11 display.</p></td>
</tr>
</tbody>
</table>
<p>For example, specify the <code class="docutils literal notranslate"><span class="pre">compute</span></code> and <code class="docutils literal notranslate"><span class="pre">utility</span></code> capabilities, allowing usage of CUDA and NVML</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--runtime<span class="o">=</span>nvidia<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">NVIDIA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">2</span>,3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-e<span class="w"> </span><span class="nv">NVIDIA_DRIVER_CAPABILITIES</span><span class="o">=</span>compute,utility<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nvidia/cuda<span class="w"> </span>nvidia-smi
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--gpus<span class="w"> </span><span class="s1">&#39;all,&quot;capabilities=compute,utility&quot;&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>nvidia/cuda:11.0-base<span class="w"> </span>nvidia-smi
</pre></div>
</div>
</div></blockquote>
</section>
<section id="constraints">
<h4>Constraints<a class="headerlink" href="#constraints" title="Permalink to this heading"></a></h4>
<p>The NVIDIA runtime also provides the ability to define constraints on the configurations supported by the container.</p>
<section id="nvidia-require">
<h5><code class="docutils literal notranslate"><span class="pre">NVIDIA_REQUIRE_*</span></code><a class="headerlink" href="#nvidia-require" title="Permalink to this heading"></a></h5>
<p>This variable is a logical expression to define constraints on the software versions or GPU architectures on the container.</p>
<p>The supported constraints are provided below:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Constraint</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cuda</span></code></p></td>
<td><p>constraint on the CUDA driver version.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">driver</span></code></p></td>
<td><p>constraint on the driver version.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">arch</span></code></p></td>
<td><p>constraint on the compute architectures of the selected GPUs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">brand</span></code></p></td>
<td><p>constraint on the brand of the selected GPUs (e.g. GeForce, Tesla, GRID).</p></td>
</tr>
</tbody>
</table>
<p>Multiple constraints can be expressed in a single environment variable: space-separated constraints are ORed,
comma-separated constraints are ANDed.
Multiple environment variables of the form <code class="docutils literal notranslate"><span class="pre">NVIDIA_REQUIRE_*</span></code> are ANDed together.</p>
<p>For example, the following constraints can be specified to the container image for constraining the supported CUDA and
driver versions:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">NVIDIA_REQUIRE_CUDA &quot;cuda&gt;=11.0 driver&gt;=450&quot;</span>
</pre></div>
</div>
</section>
<section id="nvidia-disable-require">
<h5><code class="docutils literal notranslate"><span class="pre">NVIDIA_DISABLE_REQUIRE</span></code><a class="headerlink" href="#nvidia-disable-require" title="Permalink to this heading"></a></h5>
<p>Single switch to disable all the constraints of the form <code class="docutils literal notranslate"><span class="pre">NVIDIA_REQUIRE_*</span></code>.</p>
</section>
<section id="nvidia-require-cuda">
<h5><code class="docutils literal notranslate"><span class="pre">NVIDIA_REQUIRE_CUDA</span></code><a class="headerlink" href="#nvidia-require-cuda" title="Permalink to this heading"></a></h5>
<p>The version of the CUDA toolkit used by the container. It is an instance of the
generic <code class="docutils literal notranslate"><span class="pre">NVIDIA_REQUIRE_*</span></code> case and it is set by official CUDA images. If the version of the NVIDIA driver
is insufficient to run this version of CUDA, the container will not be started. This variable
can be specified in the form <code class="docutils literal notranslate"><span class="pre">major.minor</span></code></p>
<p>The possible values for this variable: <code class="docutils literal notranslate"><span class="pre">cuda&gt;=7.5</span></code>, <code class="docutils literal notranslate"><span class="pre">cuda&gt;=8.0</span></code>, <code class="docutils literal notranslate"><span class="pre">cuda&gt;=9.0</span></code> and so on.</p>
</section>
</section>
<section id="dockerfiles">
<h4>Dockerfiles<a class="headerlink" href="#dockerfiles" title="Permalink to this heading"></a></h4>
<p>Capabilities and GPU enumeration can be set in images via environment variables. If the environment variables are
set inside the Dockerfile, you don’t need to set them on the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command-line.</p>
<p>For instance, if you are creating your own custom CUDA container, you should use the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ENV NVIDIA_VISIBLE_DEVICES all</span>
<span class="go">ENV NVIDIA_DRIVER_CAPABILITIES compute,utility</span>
</pre></div>
</div>
<p>These environment variables are already set in the NVIDIA provided CUDA images.</p>
</section>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h3>
<section id="generating-debugging-logs">
<h4>Generating debugging logs<a class="headerlink" href="#generating-debugging-logs" title="Permalink to this heading"></a></h4>
<p>For most common issues, debugging logs can be generated and can help us root cause the problem.
In order to generate these:</p>
<ul class="simple">
<li><p>Edit your runtime configuration under <code class="docutils literal notranslate"><span class="pre">/etc/nvidia-container-runtime/config.toml</span></code> and uncomment the <code class="docutils literal notranslate"><span class="pre">debug=...</span></code> line.</p></li>
<li><p>Run your container again, thus reproducing the issue and generating the logs.</p></li>
</ul>
</section>
<section id="generating-core-dumps">
<h4>Generating core dumps<a class="headerlink" href="#generating-core-dumps" title="Permalink to this heading"></a></h4>
<p>In the event of a critical failure, core dumps can be automatically generated and can help us troubleshoot issues.
Refer to <a class="reference external" href="http://man7.org/linux/man-pages/man5/core.5.html">core(5)</a> in order to generate these, in particular make sure that:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/core_pattern</span></code> is correctly set and points somewhere with write access</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ulimit</span> <span class="pre">-c</span></code> is set to a sensible default</p></li>
</ul>
<p>In case the <code class="docutils literal notranslate"><span class="pre">nvidia-container-cli</span></code> process becomes unresponsive, <a class="reference external" href="http://man7.org/linux/man-pages/man1/gcore.1.html">gcore(1)</a> can also be used.</p>
</section>
<section id="sharing-your-debugging-information">
<h4>Sharing your debugging information<a class="headerlink" href="#sharing-your-debugging-information" title="Permalink to this heading"></a></h4>
<p>You can attach a particular output to your issue with a <a class="reference external" href="https://help.github.com/articles/file-attachments-on-issues-and-pull-requests/">drag and drop</a>
into the comment section.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install-guide.html" class="btn btn-neutral float-left" title="Installation Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="release-notes.html" class="btn btn-neutral float-right" title="Release Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, NVIDIA Corporation.
      <span class="lastupdated">Last updated on 2023-04-22.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1);
    color: rgba(59,93,0,1);
    border-top: solid 3px rgba(59,93,0,1);
  }
  </style>
  

</body>
</html>