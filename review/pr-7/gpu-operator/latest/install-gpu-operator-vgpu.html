<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NVIDIA vGPU &mdash; gpu-operator 23.0.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="_static/api-styles.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/mermaid-init.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/version.js"></script>
        <script src="_static/social-media.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="NVIDIA AI Enterprise" href="install-gpu-operator-nvaie.html" />
    <link rel="prev" title="GPU Driver Upgrades" href="gpu-driver-upgrades.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
          </a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">NVIDIA GPU Operator</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About the Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="platform-support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu-driver-upgrades.html">GPU Driver Upgrades</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NVIDIA vGPU</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#high-level-workflow">High Level Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#detailed-workflow">Detailed Workflow</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install-gpu-operator-nvaie.html">NVIDIA AI Enterprise</a></li>
<li class="toctree-l1"><a class="reference internal" href="openshift/contents.html">GPU Operator on OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu-operator-mig.html">GPU Operator with MIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu-sharing.html">Time-Slicing GPUs in Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu-operator-rdma.html">GPUDirect RDMA and GPUDirect Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu-operator-kubevirt.html">GPU Operator with KubeVirt</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Licenses and Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="archive.html">Archive</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/overview.html">NVIDIA Container Toolkit</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/kubernetes/install-k8s.html">Kubernetes with GPUs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/gpu-telemetry/dcgm-exporter.html">GPU Telemetry</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/mig/mig.html">Multi-Instance GPU</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/driver-containers/overview.html">Driver Containers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">gpu-operator</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
<li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
<li>NVIDIA vGPU</li>
<li class="wy-breadcrumbs-aside">

  <span>&nbsp;</span>
</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nvidia-vgpu">
<span id="install-gpu-operator-vgpu"></span><h1>NVIDIA vGPU<a class="headerlink" href="#nvidia-vgpu" title="Permalink to this headline"></a></h1>
<p>This document provides an overview of the workflow to getting started with using the GPU Operator with NVIDIA vGPU.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NVIDIA vGPU is only supported with the NVIDIA License System.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Below steps assume <code class="docutils literal notranslate"><span class="pre">gpu-operator</span></code> as the default namespace for installing the GPU Operator. In case of RedHat OpenShift, the default
namespace would be <code class="docutils literal notranslate"><span class="pre">nvidia-gpu-operator</span></code>. Please change the namespace accordingly based on your cluster configuration. Also replace
<code class="docutils literal notranslate"><span class="pre">kubectl</span></code> in the below commands with <code class="docutils literal notranslate"><span class="pre">oc</span></code> when running on RedHat OpenShift.</p>
</div>
<section id="high-level-workflow">
<h2>High Level Workflow<a class="headerlink" href="#high-level-workflow" title="Permalink to this headline"></a></h2>
<p>The following section outlines the high level workflow to use the GPU Operator with NVIDIA vGPUs.</p>
<ol class="arabic simple">
<li><p>Download the vGPU Software and latest NVIDIA vGPU Driver Catalog file.</p></li>
<li><p>Clone driver container source repository for building private driver image.</p></li>
<li><p>Build the driver container image.</p></li>
<li><p>Push the driver container image to your private repository.</p></li>
<li><p>Create a <cite>ConfigMap</cite> in the <cite>gpu-operator</cite> namespace with vGPU license configuration file.</p></li>
<li><p>Create an <cite>ImagePullSecret</cite> in the <cite>gpu-operator</cite> namespace for your private repository.</p></li>
<li><p>Install the GPU Operator.</p></li>
</ol>
<section id="detailed-workflow">
<h3>Detailed Workflow<a class="headerlink" href="#detailed-workflow" title="Permalink to this headline"></a></h3>
<p>Download the vGPU Software and latest NVIDIA vGPU driver catalog file from the <a class="reference external" href="https://nvid.nvidia.com/dashboard/#/dashboard">NVIDIA Licensing Portal</a>.</p>
<ol class="arabic simple">
<li><p>Login to the NVIDIA Licensing Portal and navigate to the “Software Downloads” section.</p></li>
<li><p>The NVIDIA vGPU Software is located in the Software Downloads section of the NVIDIA Licensing Portal.</p></li>
<li><p>The NVIDIA vGPU catalog driver file is located in the “Additional Software” section.</p></li>
<li><p>The vGPU Software bundle is packaged as a zip file. Download and unzip the bundle to obtain the NVIDIA vGPU Linux guest driver (NVIDIA-Linux-x86_64-&lt;version&gt;-grid.run file)</p></li>
</ol>
<p>Clone the driver container repository and build driver image</p>
<ul class="simple">
<li><p>Open a terminal and clone the driver container image repository</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone https://gitlab.com/nvidia/container-images/driver
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> driver
</pre></div>
</div>
<ul class="simple">
<li><p>Change to the OS directory under the driver directory.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> ubuntu20.04
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For RedHat OpenShift, run <code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">rhel</span></code> to use <code class="docutils literal notranslate"><span class="pre">rhel</span></code> folder instead.</p>
</div>
<ul class="simple">
<li><p>Copy the NVIDIA vGPU guest driver from your extracted zip file and the NVIDIA vGPU driver catalog file</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp &lt;local-driver-download-directory&gt;/*-grid.run drivers
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cp vgpuDriverCatalog.yaml drivers
</pre></div>
</div>
<ul class="simple">
<li><p>Build the driver container image</p></li>
</ul>
<p>Set the private registry name using below command on the terminal</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">PRIVATE_REGISTRY</span><span class="o">=</span>&lt;private registry name&gt;
</pre></div>
</div>
<p>Set the OS_TAG. The OS_TAG has to match the Guest OS version. Please refer to <a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/platform-support.html#linux-distributions">OS Support</a> for the list of supported OS distributions.
In the below example <code class="docutils literal notranslate"><span class="pre">ubuntu20.04</span></code> is used, for RedHat OpenShift this should be <code class="docutils literal notranslate"><span class="pre">rhcos4.x</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is the supported minor OCP version.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">OS_TAG</span><span class="o">=</span>ubuntu20.04
</pre></div>
</div>
<p>Set the driver container image version to a user defined version number. For example, <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">VERSION</span><span class="o">=</span><span class="m">1</span>.0.0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">VERSION</span></code> can be any user defined value. Please note this value to use during operator installation command</p>
</div>
<p>Set the version of the CUDA base image used when building the driver container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">CUDA_VERSION</span><span class="o">=</span><span class="m">11</span>.8.0
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CUDA_VERSION</span></code> only dictates what base image is used when building the driver container,
and does not have any correlation to the version of CUDA associated with / supported by the
resulting driver container.</p>
</div>
<p>Replace the <code class="docutils literal notranslate"><span class="pre">VGPU_DRIVER_VERSION</span></code> below with the appropriate Linux guest vGPU driver version downloaded
from the NVIDIA software portal. In this example, the <code class="docutils literal notranslate"><span class="pre">525.60.13</span></code> driver has been downloaded. Note that
the <code class="docutils literal notranslate"><span class="pre">-grid</span></code> suffix needs to be added to the environment variable as shown:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">VGPU_DRIVER_VERSION</span><span class="o">=</span><span class="m">525</span>.60.13-grid
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GPU Operator automatically selects the compatible guest driver version from the drivers bundled with the <code class="docutils literal notranslate"><span class="pre">driver</span></code> image.
If version check is disabled with <code class="docutils literal notranslate"><span class="pre">--build-arg</span> <span class="pre">DISABLE_VGPU_VERSION_CHECK=true</span></code> when building driver image, then
<code class="docutils literal notranslate"><span class="pre">VGPU_DRIVER_VERSION</span></code> value is used as default.</p>
</div>
<p>Build the driver container image</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo docker build <span class="se">\</span>
  --build-arg <span class="nv">DRIVER_TYPE</span><span class="o">=</span>vgpu <span class="se">\</span>
  --build-arg <span class="nv">DRIVER_VERSION</span><span class="o">=</span><span class="nv">$VGPU_DRIVER_VERSION</span> <span class="se">\</span>
  --build-arg <span class="nv">CUDA_VERSION</span><span class="o">=</span><span class="nv">$CUDA_VERSION</span> <span class="se">\</span>
  -t <span class="si">${</span><span class="nv">PRIVATE_REGISTRY</span><span class="si">}</span>/driver:<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>-<span class="si">${</span><span class="nv">OS_TAG</span><span class="si">}</span> .
</pre></div>
</div>
<ul class="simple">
<li><p>Push the driver container image to your private repository</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo docker login <span class="si">${</span><span class="nv">PRIVATE_REGISTRY</span><span class="si">}</span> --username<span class="o">=</span>&lt;username&gt; <span class="o">{</span>enter password on prompt<span class="o">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo docker push <span class="si">${</span><span class="nv">PRIVATE_REGISTRY</span><span class="si">}</span>/driver:<span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span>-<span class="si">${</span><span class="nv">OS_TAG</span><span class="si">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Install the GPU Operator.</p></li>
</ul>
<p>Create a NVIDIA vGPU license file named <cite>gridd.conf</cite> with the below content.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Description: Set License Server Address
# Data type: string
# Format:  &quot;&lt;address&gt;&quot;
ServerAddress=&lt;license server address&gt;
</pre></div>
</div>
<p>Input the license server address of the License Server</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Optionally add a backup/secondary license server address if one is configured. <code class="docutils literal notranslate"><span class="pre">BackupServerAddress=&lt;backup</span> <span class="pre">license</span> <span class="pre">server</span> <span class="pre">address&gt;</span></code></p>
</div>
<p>Create a ConfigMap <cite>licensing-config</cite> using <cite>gridd.conf</cite> file created above</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl create namespace gpu-operator
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl create configmap licensing-config <span class="se">\</span>
  -n gpu-operator --from-file<span class="o">=</span>gridd.conf
</pre></div>
</div>
<p>Creating an image pull secrets</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span> <span class="nv">REGISTRY_SECRET_NAME</span><span class="o">=</span>registry-secret
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl create secret docker-registry <span class="si">${</span><span class="nv">REGISTRY_SECRET_NAME</span><span class="si">}</span> <span class="se">\</span>
  --docker-server<span class="o">=</span><span class="si">${</span><span class="nv">PRIVATE_REGISTRY</span><span class="si">}</span> --docker-username<span class="o">=</span>&lt;username&gt; <span class="se">\</span>
  --docker-password<span class="o">=</span>&lt;password&gt; <span class="se">\</span>
  --docker-email<span class="o">=</span>&lt;email-id&gt; -n gpu-operator
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note the secret name <code class="docutils literal notranslate"><span class="pre">REGISTRY_SECRET_NAME</span></code> for using during operator installation command.</p>
</div>
<ul class="simple">
<li><p>Install GPU Operator via the Helm chart</p></li>
</ul>
<p>Please refer to <a class="reference internal" href="installation.html#install-gpu-operator"><span class="std std-ref">Install NVIDIA GPU Operator</span></a> section for GPU operator installation command and options for vGPU on Kubernetes.</p>
<ul class="simple">
<li><p>Install GPU Operator via OLM on RedHat OpenShift</p></li>
</ul>
<p>Please refer to <a class="reference internal" href="openshift/install-gpu-ocp.html#install-nvidiagpu"><span class="std std-ref">Installing the NVIDIA GPU Operator</span></a> section for GPU operator installation command and options for using NVIDIA vGPU on RedHat OpenShift.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, NVIDIA.
      <span class="lastupdated">Last updated on Mar 06, 2023.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>